---
title: "Risoluzione dei problemi relativi alla rotazione delle chiavi di crittografia: [!DNL CVE-2024-34102]"
promoted: true
description: Applica una patch isolata supplementare per risolvere ulteriori problemi relativi all'aggiornamento delle chiavi di crittografia da  [!DNL CVE-2024-34102] per Adobe Commerce 2.4.4-p8, 2.4.5-p7, 2.4.6-p5, 2.4.7 e versioni precedenti.
feature: Compliance, Security
role: Developer
source-git-commit: c5c4fb6871500485fe86972e289edb69f0dcfe52
workflow-type: tm+mt
source-wordcount: '923'
ht-degree: 0%

---

# Risoluzione dei problemi relativi alla rotazione delle chiavi di crittografia: [!DNL CVE-2024-34102]

Questo articolo ha lo scopo di aiutare gli esercenti a risolvere i problemi relativi alla rotazione delle chiavi di crittografia dopo aver già eseguito i passaggi descritti in questo [articolo](https://experienceleague.adobe.com/it/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102) su [!DNL CVE-2024-34102].

Se hai già seguito i passaggi descritti nell’articolo precedente e riscontri problemi durante la rotazione delle chiavi di crittografia, disponiamo di una patch isolata per risolvere potenziali problemi.

Per illustrare i passaggi precedentemente comunicati e riepilogati in precedenza, per la protezione da [!DNL CVE-2024-34102], nonché le ulteriori procedure di risoluzione dei problemi riportate di seguito, è inoltre possibile utilizzare questo diagramma di flusso:


![Grafico flusso di protezione CVE-2024-34102.jpg](assets/cve-2024-34102-protection-flow-chart.jpg){zoomable="yes"}


## Come applicare la patch isolata per eseguire il nuovo comando

Decomprimi il file e vedi [Come applicare una patch del compositore fornita dall&#39;Adobe](https://experienceleague.adobe.com/docs/commerce-knowledge-base/kb/how-to/how-to-apply-a-composer-patch-provided-by-magento.html?lang=it) nella Knowledge Base di supporto per le istruzioni.

## Aggiunta di una nuova chiave di crittografia senza utilizzare le variabili di ambiente

Il comportamento predefinito dell&#39;applicazione consiste nell&#39;archiviare la chiave di crittografia nel file `app/etc/env.php`.

I [passaggi descritti nella documentazione](https://experienceleague.adobe.com/it/docs/commerce-admin/systems/security/encryption-key) descrivono come modificare questa chiave all&#39;interno di tale file utilizzando l&#39;interfaccia [!UICONTROL Admin].

I passaggi e la patch isolata forniti in questa sezione consentono di modificare facilmente il valore del file e di risolvere i problemi che potrebbero verificarsi tramite l&#39;interfaccia [!UICONTROL Admin].

Tuttavia, il modo più semplice e sicuro per gestire la chiave di crittografia consiste nell’utilizzare le variabili di ambiente. Se utilizzi già variabili di ambiente o sei interessato a utilizzarle per gestire questa chiave, è disponibile una sezione separata che descrive tali passaggi.

## Prodotti e versioni interessati

Adobe Commerce su Cloud, Adobe Commerce on-premise e Magento Open Source:

* 2.4.7-p1 e versioni precedenti
* 2.4.6-p6 e versioni precedenti
* 2.4.5-p8 e versioni precedenti
* 2.4.4-p9 e versioni precedenti

## Patch isolata per la risoluzione dei problemi relativi alla rotazione della chiave di crittografia

Utilizza le seguenti patch allegate, a seconda della versione di Adobe Commerce/Magento Open Source in uso:

### Per le versioni 2.4.7, 2.4.7-p1:

* [ac-12589-2-4-7x-composer-patch.zip](assets/ac-12589-2-4-7x-composer-patch.zip)

### Per le versioni 2.4.6, 2.4.6-p1, 2.4.6-p2, 2.4.6-p3, 2.4.6-p4, 2.4.6-p5, 2.4.6-p6:

* [ac-12589-2-4-6x-composer-patch.zip](assets/ac-12589-2-4-6x-composer-patch.zip)

### Per le versioni 2.4.5, 2.4.5-p1, 2.4.5-p2, 2.4.5-p3, 2.4.5-p4, 2.4.5-p5, 2.4.5-p6, 2.4.5-p7, 2.4.5-p8:

* [ac-12589-2.4.5x_COMPOSER_patch.zip](assets/ac-12589-2-4-5x-composer-patch.zip)

### Per le versioni 2.4.4, 2.4.4-p1, 2.4.4-p2, 2.4.4-p3, 2.4.4-p4, 2.4.4-p5, 2.4.4-p6, 2.4.4-p7, 2.4.4-p8, 2.4.4-p9:

* [ac-12589-2-4-4x-composer-patch.zip](assets/ac-12589-2-4-4x-composer-patch.zip)

<!--
* [ac-12589-2-4-4x-composer-patch.zip](assets/ac-12589-2-4-4x-composer-patch.zip)
-->

Dopo aver installato la patch isolata, modificare la chiave di crittografia attiva con il nuovo comando [!DNL CLI].

>[!NOTE]
>
>**Questo nuovo comando [!DNL CLI] attiverà una pulitura della cache al momento dell&#39;esecuzione.**

1. Questo nuovo comando deve essere eseguito nell&#39;ambiente che contiene il file `app/etc/env.php` per la chiave da aggiornare.
1. Conferma l’esistenza del nuovo comando:

   ```
   bin/magento list | grep encryption:key:change
   ```

   Dovresti visualizzare il seguente output:

   ```
   encryption:key:change Change the encryption key inside the env.php file.
   ```

1. Modificare la chiave di crittografia:

   ```
   bin/magento encryption:key:change
   ```

1. Se hai eseguito questo comando sul sistema di produzione, non è necessario eseguire ulteriori azioni.
Se hai eseguito questa operazione su un sistema di sviluppo, **devi** inserire la modifica nel sistema di produzione, come faresti normalmente con le impostazioni di configurazione riservate.

## Aggiorna la chiave di crittografia utilizzando le variabili di ambiente anziché la patch isolata

In alternativa alla sezione precedente, questi passaggi consentiranno di aggiungere una nuova chiave di crittografia mantenendo i dati crittografati esistenti, anche se si sta utilizzando `app/etc/env.php` predefinito.
**Questa sezione si applica ad Adobe Commerce su Cloud e Cloud Starter, ma anche ad Adobe Commerce on-premise**, anche se i passaggi e le posizioni esatti delle variabili dipenderanno dall&#39;infrastruttura.

### Raccogli il valore corrente

* Se si stanno già gestendo le chiavi con le variabili di ambiente, è possibile che si trovino in [diverse posizioni possibili](https://experienceleague.adobe.com/it/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-intro), ma è probabile che si trovino nella variabile [`CRYPT_KEY`](https://experienceleague.adobe.com/it/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-deploy#crypt_key) come descritto nella documentazione.
* Se non si utilizzano le variabili, la chiave di crittografia sarà in `app/etc/env.php` all&#39;interno della chiave dati `crypt/key`.

In entrambi i casi, può essere un valore su più righe e contenere più righe casuali di dati.

### Genera un nuovo valore per le versioni 2.4.7x

Le chiavi di crittografia sono 32 byte di dati casuali codificati con [!DNL base64] e con prefisso `base64`.
Per generare una nuova chiave:

1. Con lo strumento desiderato, genera 32 byte casuali di dati codificati con [!DNL base64]. Ad esempio, utilizzando [!DNL OpenSSL CLI], è possibile eseguire `openssl rand -base64 32`, ma è possibile utilizzare qualsiasi strumento di generazione casuale crittografato attendibile.
1. Aggiungi al valore il prefisso `base64`. Ad esempio, se il comando `openssl` genera *ABC123*, il valore diventa: *base64ABC123*
1. Aggiungi il valore generato al valore esistente raccolto in precedenza. Ad esempio, se il valore esistente è *base64HelloWorld*, il nuovo valore diventerà:<br>

   ```
   base64HelloWorld
   base64ABC123
   ```

### Genera un nuovo valore per 2.4.6x e versioni precedenti

Le chiavi di crittografia della versione 2.4.6x e delle versioni precedenti sono 16 byte di dati casuali in un formato con codifica [!DNL hex].
Per generare una nuova chiave:

1. Utilizzando lo strumento desiderato, genera 16 byte casuali di dati. Ad esempio, utilizzando [!DNL OpenSSL CLI], è possibile eseguire `openssl rand -hex 16`, ma è possibile utilizzare qualsiasi strumento di generazione casuale crittografato attendibile.
1. Aggiungi il valore generato al valore esistente raccolto in precedenza. Ad esempio, se il valore esistente è *abc123* e il valore casuale del passaggio precedente è *456def*, il nuovo valore diventerà:<br>

   ```
   abc123
   456def
   ```

### Aggiungi una nuova variabile di ambiente

Utilizzare [[!UICONTROL Cloud Console] o  [!DNL magento-cloud CLI]](https://experienceleague.adobe.com/it/docs/commerce-cloud-service/user-guide/configure/env/variable-levels) per impostare la `env:MAGENTO_DC_CRYPT__KEY` [variabile di ambiente](https://experienceleague.adobe.com/it/docs/commerce-cloud-service/user-guide/configure/env/stage/variables-cloud) su questo nuovo valore.

>[!NOTE]
>
>Se scegli di contrassegnare la variabile come *sensibile*, puoi salvare un backup esterno di questo valore, poiché sarà nascosto da tutte le interfacce e visibile solo all&#39;applicazione.

Al momento del salvataggio della variabile, viene attivata automaticamente una ridistribuzione che determinerà l’applicazione del valore.

## Aggiornamenti di sicurezza

Aggiornamenti di sicurezza correlati disponibili per Adobe Commerce:

* [Aggiornamento di sicurezza disponibile per Adobe Commerce - APSB24-40](https://experienceleague.adobe.com/it/docs/commerce-knowledge-base/kb/troubleshooting/known-issues-patches-attached/security-update-available-for-adobe-commerce-apsb24-40-revised-to-include-isolated-patch-for-cve-2024-34102)
* [Bollettino sulla sicurezza di Adobe ([!DNL APSB24-40])](https://helpx.adobe.com/it/security/products/magento/apsb24-40.html)
